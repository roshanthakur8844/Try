<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Reality Organism</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:black;
  overflow:hidden;
  touch-action:none;
  font-family:monospace;
}
canvas{
  position:absolute;
  inset:0;
}
#ui{
  position:fixed;
  top:10px;
  left:10px;
  color:#00ffcc;
  font-size:12px;
  text-shadow:0 0 8px #00ffcc;
  z-index:10;
}
#hint{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  color:#ff00ff;
  font-size:11px;
  opacity:.8;
}
</style>
</head>

<body>

<canvas id="main"></canvas>
<canvas id="cam" style="opacity:.08;mix-blend-mode:difference"></canvas>

<div id="ui">
  <div>REALITY STATUS: UNSTABLE</div>
  <div id="count">ENTITIES: 0</div>
</div>

<div id="hint">Tap to spawn â€¢ Camera = distortion only</div>

<script>
/* ================= SETUP ================= */
const main = document.getElementById("main");
const ctx = main.getContext("2d");

const cam = document.getElementById("cam");
const camCtx = cam.getContext("2d");

let W,H,DPR=Math.min(2,window.devicePixelRatio||1);

function resize(){
  W=innerWidth; H=innerHeight;
  [main,cam].forEach(c=>{
    c.width=W*DPR;
    c.height=H*DPR;
    c.style.width=W+"px";
    c.style.height=H+"px";
    c.getContext("2d").setTransform(DPR,0,0,DPR,0,0);
  });
}
resize();
addEventListener("resize",resize);

/* ================= ENTITY ================= */
let entities=[];

class Entity{
  constructor(x,y){
    this.x=x;
    this.y=y;
    this.vx=(Math.random()-0.5)*4;
    this.vy=(Math.random()-0.5)*4;
    this.size=Math.random()*18+10;
    this.hue=Math.random()*360;
    this.life=1;
  }
  update(){
    this.vx+=Math.sin(this.y*0.01)*0.02;
    this.vy+=Math.cos(this.x*0.01)*0.02;
    this.x+=this.vx;
    this.y+=this.vy;

    if(this.x<0||this.x>W)this.vx*=-1;
    if(this.y<0||this.y>H)this.vy*=-1;

    this.life-=0.001;
  }
  draw(){
    ctx.fillStyle=`hsla(${this.hue},100%,60%,${this.life})`;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

/* ================= CAMERA DISTORTION ================= */
let cameraStarted=false;

function startCamera(){
  if(cameraStarted) return;
  cameraStarted=true;

  navigator.mediaDevices.getUserMedia({video:true})
  .then(stream=>{
    const video=document.createElement("video");
    video.srcObject=stream;
    video.play();

    function camLoop(){
      camCtx.clearRect(0,0,W,H);
      camCtx.globalAlpha=0.1;
      camCtx.drawImage(video,0,0,W,H);
      requestAnimationFrame(camLoop);
    }
    camLoop();
  })
  .catch(()=>{}); // safe fail
}

/* ================= INPUT ================= */
main.addEventListener("pointerdown",e=>{
  startCamera();
  for(let i=0;i<3;i++){
    entities.push(
      new Entity(
        e.clientX+(Math.random()-0.5)*20,
        e.clientY+(Math.random()-0.5)*20
      )
    );
  }
});

/* ================= LOOP ================= */
function animate(){
  ctx.fillStyle="rgba(0,0,0,.25)";
  ctx.fillRect(0,0,W,H);

  entities=entities.filter(e=>e.life>0);
  entities.forEach(e=>{
    e.update();
    e.draw();
  });

  document.getElementById("count").textContent=
    "ENTITIES: "+entities.length;

  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
