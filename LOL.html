<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Organism Runtime</title>

<style>
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:monospace;
}
canvas{position:fixed;inset:0}
#ui{
  position:fixed;
  top:10px;left:10px;
  color:#00ffcc;
  font-size:12px;
  text-shadow:0 0 8px #00ffcc;
  z-index:10;
}
</style>
</head>

<body>

<canvas id="world"></canvas>

<div id="ui">
  <div>ORGANISM: ACTIVE</div>
  <div id="stats">BOOTINGâ€¦</div>
</div>

<script>
/* ===== CORE ===== */
const canvas = document.getElementById("world");
const ctx = canvas.getContext("2d");

let W,H,DPR=Math.min(2,devicePixelRatio||1);
function resize(){
  W=innerWidth; H=innerHeight;
  canvas.width=W*DPR;
  canvas.height=H*DPR;
  canvas.style.width=W+"px";
  canvas.style.height=H+"px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
resize(); addEventListener("resize",resize);

/* ===== ENTITY ===== */
let entities=[];
class Entity{
  constructor(x,y){
    this.x=x; this.y=y;
    this.vx=(Math.random()-0.5)*3;
    this.vy=(Math.random()-0.5)*3;
    this.size=Math.random()*10+8;
    this.hue=Math.random()*360;
    this.energy=1;
  }
  update(){
    this.vx+=Math.sin(time*0.01+this.y*0.01)*0.05;
    this.vy+=Math.cos(time*0.01+this.x*0.01)*0.05;
    this.x+=this.vx;
    this.y+=this.vy;

    if(this.x<0||this.x>W)this.vx*=-1;
    if(this.y<0||this.y>H)this.vy*=-1;

    this.energy-=0.0005;
  }
  draw(){
    ctx.fillStyle=`hsla(${this.hue},100%,60%,${this.energy})`;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

/* ===== AUTO-SEED (CRITICAL FIX) ===== */
for(let i=0;i<5;i++){
  entities.push(new Entity(
    Math.random()*W,
    Math.random()*H
  ));
}

/* ===== INPUT (ROBUST) ===== */
function spawn(x,y){
  for(let i=0;i<3;i++){
    entities.push(new Entity(
      x+(Math.random()-0.5)*40,
      y+(Math.random()-0.5)*40
    ));
  }
}

canvas.addEventListener("mousedown",e=>spawn(e.clientX,e.clientY));
canvas.addEventListener("touchstart",e=>{
  const t=e.touches[0];
  spawn(t.clientX,t.clientY);
});

/* ===== LOOP ===== */
let time=0;
function loop(){
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,W,H);

  entities=entities.filter(e=>e.energy>0);
  entities.forEach(e=>{e.update();e.draw();});

  document.getElementById("stats").textContent=
    `ENTITIES: ${entities.length}`;

  time++;
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
